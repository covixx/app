
{% extends 'base.html.twig' %}

{% block menu %}{% endblock %}

{% block body %}

    <br/>

    <div class="jumbotron">

        <h3>{{ 'space.consult_data.title'|trans }}</h3>

        <hr/>

        <h4>{{ 'space.consult_data.identity_main'|trans }}</h4>

        <table style="border: 1px solid {{ lightgrey }};margin-bottom: 10px;">

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_id'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.id }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_identifier'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.identifier }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_external'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.nivol }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_firstname'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.firstname }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_lastname'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.lastname }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_minor'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.minor ? '✅' : '❌' }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_phone'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.phoneNumber }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_phone_locked'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.phoneNumberLocked ? '✅' : '❌' }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_phone_optin'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.phoneNumberOptin ? '✅' : '❌' }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_email'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.email }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_email_locked'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.emailLocked ? '✅' : '❌' }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_email_optin'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.emailOptin ? '✅' : '❌' }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_skills'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {% for skill in session.volunteer.tagsView %}
                        {{ ('tag.' ~ skill)|trans }}{% if not loop.last %},{% endif %}
                    {% endfor %}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_structures'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {% for structure in session.volunteer.structures %}
                        {{ structure.name }}<br/>
                    {% endfor %}
                </td>
            </tr>

        </table>

        <hr/>

        <h4>{{ 'space.consult_data.identity_sync'|trans }}</h4>

        <table style="border: 1px solid {{ lightgrey }};margin-bottom: 10px;">

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_locked'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.locked ? '❌' : '✅' }}
                </td>
            </tr>

            <tr style="border-right: 1px solid {{ lightgrey }};">
                <td style="padding:5px;">
                    <strong>{{ 'space.consult_data.identity_last_update'|trans }}</strong>
                </td>
                <td style="padding:5px;">
                    {{ session.volunteer.lastPegassUpdate|date('d/m/Y H:i') }}
                </td>
            </tr>



        </table>

            {#
        identity_locked: 'Synchronisation active'
        identity_last_update: 'Dernière synchronisation'
        identity_next_update: 'Prochaine synchronisation'
        identity_report_update: 'Dernier rapport de synchronisation'

        identity_user: 'Utilisateur sur RedCall'
        identity_user_locale: 'Langue de la plateforme'
        identity_user_developer: 'Accès développeur'
        identity_user_admin: 'Accès administrateur'
        identity_user_structures: 'Structure(s) d''action'
            #}


        <hr/>

        <div class="h4">{{ 'space.consult_data.communications'|trans }}</div>

        {% for communication in communications %}

            {% for message in communication %}

                <table style="border: 1px solid {{ lightgrey }};margin-bottom: 10px;" width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td style="border-right: 1px solid {{ lightgrey }};"><br/></td>
                    </tr>
                    <tr>
                        <td style="background-color:{{ lightgrey }};border-right: 1px solid {{ lightgrey }};">
                            &nbsp;
                        </td>
                    </tr>
                    <tr>
                        <td style="background-color:{{ red }};padding-top:5px;padding-bottom:5px;padding-left:50px;border-right: 1px solid {{ lightgrey }};">

                            {% set context = {
                                '%day%':message.updatedAt|date('d'),
                                '%month%':message.updatedAt|date('m'),
                                '%year%':message.updatedAt|date('Y'),
                                '%hours%':message.updatedAt|date('H'),
                                '%mins%':message.updatedAt  |date('i'),
                            } %}
                            <span style="font-size:12px;color:white;">
                                {% if message.communication.type == constant('App\\Entity\\Communication::TYPE_SMS') %}
                                    {{ 'space.consult_data.announcement_sms'|trans(context) }}
                                {% elseif message.communication.type == constant('App\\Entity\\Communication::TYPE_CALL') %}
                                    {{ 'space.consult_data.announcement_voice'|trans(context) }}
                                {% else %}
                                    {{ 'space.consult_data.announcement_email'|trans(context) }}
                                {% endif %}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td style="background-color:{{ lightgrey }};border-right: 1px solid {{ lightgrey }};">
                            &nbsp;
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">&nbsp;</td>
                    </tr>
                    <tr>
                        <td style="padding-left:45px;padding-right:60px;color:black;font-size:14px;border-right: 1px solid {{ lightgrey }};">
                            {% if message.communication.subject %}
                                <p class="h4">{{ message.communication.subject }}</p>
                            {% endif %}

                            <div>{{ message.communication.body|nl2br }}</div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">&nbsp;</td>
                    </tr>

                    {% if message.communication.choices|length %}
                        <tr>
                            <td style="padding-left:45px;padding-right:60px;color:black;font-size:14px;border-right: 1px solid {{ lightgrey }};">
                                <strong>{{ 'space.consult_data.choices'|trans }}</strong>
                                <table>
                                    {% for choice in message.communication.choices %}
                                    <tr>
                                        <td style="padding: 5px;">
                                            {{ message.prefix }}{{ choice.code }}
                                        </td>
                                        <td style="padding: 5px;">
                                            {{ choice.label }}
                                        </td>
                                        <td style="padding: 5px;">
                                            {% if message.answerByChoice(choice) %}
                                                ✅
                                            {% else %}
                                                ❌
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">&nbsp;</td>
                        </tr>
                    {% endif %}

                    {% if message.answers|length %}
                        <tr>
                            <td style="padding-left:45px;padding-right:60px;color:black;font-size:14px;border-right: 1px solid {{ lightgrey }};">
                                <strong>{{ 'space.consult_data.answers'|trans }}</strong>
                                <table>
                                    {% for answer in message.answers %}
                                        <tr>
                                            <td style="padding: 5px;">
                                                {{ answer.receivedAt|date('d/m/Y H:i') }}
                                            </td>
                                            <td style="padding: 5px;">
                                                {{ answer.raw }}
                                            </td>
                                            <td style="padding: 5px;">

                                            </td>
                                        </tr>
                                    {% endfor %}
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">&nbsp;</td>
                        </tr>
                    {% endif %}


                    {% if message.communication.geoLocation %}
                        <tr>
                            <td style="padding-left:45px;padding-right:60px;color:black;font-size:14px;border-right: 1px solid {{ lightgrey }};">
                                <strong>{{ 'space.consult_data.geo'|trans }}</strong>
                                <table>
                                    <tr>
                                        <td style="padding: 5px;">{{ 'space.consult_data.geo_date'|trans }}</td>
                                        <td style="padding: 5px;">
                                            {% if message.geoLocation %}
                                                {{ message.geoLocation.datetime|date('d/m/Y H:i') }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 5px;">{{ 'space.consult_data.geo_longitude'|trans }}</td>
                                        <td style="padding: 5px;">
                                            {% if message.geoLocation %}
                                                {{ message.geoLocation.longitude }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 5px;">{{ 'space.consult_data.geo_latitude'|trans }}</td>
                                        <td style="padding: 5px;">
                                            {% if message.geoLocation %}
                                                {{ message.geoLocation.latitude }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 5px;">{{ 'space.consult_data.geo_accuracy'|trans }}</td>
                                        <td style="padding: 5px;">
                                            {% if message.geoLocation %}
                                                {{ message.geoLocation.accuracy }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 5px;">{{ 'space.consult_data.geo_heading'|trans }}</td>
                                        <td style="padding: 5px;">
                                            {% if message.geoLocation %}
                                                {{ message.geoLocation.heading }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">&nbsp;</td>
                        </tr>
                    {% endif %}

                </table>

            {% endfor %}

        {% endfor %}


    </div>

    <a href="{{ path('space_home', {sessionId: session.sessionId}) }}"
       class="btn btn-secondary">{{ 'base.button.back'|trans }}</a>

    <br/><br/>

{% endblock %}
